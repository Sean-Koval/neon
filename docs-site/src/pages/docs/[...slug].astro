---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getDocEntries, slugFromPath } from '../../lib/docs';

export async function getStaticPaths() {
  const docs = import.meta.glob('../../../../docs/**/*.md');
  return Object.keys(docs).map((path) => ({
    params: { slug: slugFromPath(path) },
    props: { path },
  }));
}

const docs = import.meta.glob('../../../../docs/**/*.md');
const { path } = Astro.props;
const module = await docs[path]();
const Content = module.default;
const slugTitle = slugFromPath(path).split('/').pop() || 'Doc';
const title =
  module.frontmatter?.title ||
  slugTitle.replace(/[-_]/g, ' ').replace(/\b\w/g, (char) => char.toUpperCase());
const base = import.meta.env.BASE_URL;
const entries = await getDocEntries();
const activeSlug = slugFromPath(path);
---

<BaseLayout title={`Neon Docs | ${title}`} description={`Neon docs: ${title}`}>
  <section class="container doc-layout">
    <aside class="doc-sidebar">
      <a class="pill" href={`${base}docs`}>Documentation</a>
      {Array.from(new Set(entries.map((entry) => entry.category))).map((category) => (
        <div class="doc-group">
          <div class="doc-group-title">{category}</div>
          <div class="doc-tree">
            {entries
              .filter((entry) => entry.category === category)
              .map((entry) => (
                <a
                  class={entry.slug === activeSlug ? 'active' : ''}
                  href={`${base}docs/${entry.slug}`}
                >
                  {entry.title}
                </a>
              ))}
          </div>
        </div>
      ))}
    </aside>
    <article class="doc-content">
      <Content />
    </article>
  </section>
</BaseLayout>
